function inicio(){window.location.href="/"}function terminosUso(){window.location.href="/terminosUso"}function analizarPagina(){window.location.href="/analizarPagina"}let activo={"background-color":"#007bff",color:"#ffffff"},activoSubmenu={"background-color":"#007bff91",color:"#ffffff"},inactivo={"background-color":"",color:""};function ocultarCaracteristicas(){let a=document.getElementsByClassName("caracteristica");for(let e=0;e<a.length;e++)a[e].style.display="none";let t=document.getElementById("transparencia");t.style.display="none"}function mostrarCaracteristicas(){let a=document.getElementsByClassName("caracteristica");for(let e=0;e<a.length;e++)a[e].style.display="",id=a[e].id;localStorage.getItem("transparencia")&&mostrarTransparencia()}function mostrarTransparencia(){let a=document.getElementById("transparencia");a.style.display=""}function ocultarTransparencia(){let a=document.getElementById("transparencia");a.style.display="none"}function generarReporte(){$.ajax({url:"/generarReporte",method:"POST",data:{token:localStorage.getItem("evaluacionToken")},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(a,e,t){var r=t.getResponseHeader("fecha"),i=t.getResponseHeader("plataforma");console.log("Fecha del informe:",r),console.log("Plataforma:",i);var n=new Blob([a],{type:"text/csv"}),c=URL.createObjectURL(n),o=document.createElement("a");o.href=c,o.download="informe_transparencia_"+i+"_"+r+".csv",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(c)},error:function(a,e,t){console.error("Error generating report:",t)}})}function verTransparencia(){$.ajax({url:"/verTransparencia",data:{token:localStorage.getItem("evaluacionToken")},type:"POST",dataType:"json",success:function(a){localStorage.setItem("transparencia",!0),mostrarTransparencia(),selectorSidebarItem("transparencia"),document.getElementById("contenidoFormulario").innerHTML=a.vista,crearGraficaNavegadores(["Cumple","No cumple"],[71,29],"grafica_transparencia")},error:function(a,e,t){$(document).Toasts("create",{class:"bg-danger",title:"\xa1Error!",subtitle:"Operaci\xf3n fallida",body:"Fallo en la operacion.",icon:"fas fa-check-circle",autohide:!0,delay:3e3})}})}function selectorSidebarItem(a){$(".sidebar-container .nav-link").removeClass("active").css(inactivo),$(".sidebar-container .nav-item").removeClass("menu-open menu-is-opening"),$(".sidebar-container .nav-treeview").hide();let e=$(".sidebar-container .nav-link").filter(function(){return $(this).text().trim().toLowerCase()===a.toLowerCase()});if(0===e.length&&(e=$("#"+a)),e.length){if(e.addClass("active").css(activo),e.closest(".nav-treeview").length){e.css(activoSubmenu);let t=e.closest(".nav-item.has-treeview"),r=t.children(".nav-link");t.addClass("menu-open menu-is-opening"),r.addClass("active").css(activo),t.children(".nav-treeview").show(),r.find(".right").removeClass("fa-angle-left").addClass("fa-angle-down")}else if(e.parent().hasClass("has-treeview")){let i=e.parent();i.addClass("menu-open menu-is-opening"),i.children(".nav-treeview").show(),e.find(".right").removeClass("fa-angle-left").addClass("fa-angle-down")}e[0].scrollIntoView({behavior:"smooth",block:"nearest"})}}function verCaracteristica(a){$.ajax({url:"/obtenerDatosCaracteristica",data:{nombre:a,token:localStorage.getItem("evaluacionToken")},type:"GET",dataType:"json",success:function(e){if(document.getElementById("contenidoFormulario").innerHTML=e.vista,0!==e.resultados.length)for(let t of e.resultados)mostrarResultadoMetrica(t.id_metrica,t.abreviatura,t.resultado,t.formula,t.escala,t.unidad);null!=e.valorCaracteristica&&(e.datos.metricas.length>0?e.datos.metricas:e.datos.sub_caracteristicas,mostrarResultadoCaracteristica(e.valorCaracteristica.id_caracteristica,e.valorCaracteristica.valor,e.valorCaracteristica.formula,[]),crearGraficaNavegadores(["Cumple","No cumple"],[e.valorCaracteristica.valor,100-e.valorCaracteristica.valor],"grafica_caracteristica_"+e.valorCaracteristica.id_caracteristica)),selectorSidebarItem(a)},error:function(a,e,t){$(document).Toasts("create",{class:"bg-danger",title:"\xa1Error!",subtitle:"Operaci\xf3n fallida",body:"Fallo en la operacion.",icon:"fas fa-check-circle",autohide:!0,delay:3e3})}})}function mostrarResultadoMetrica(a,e,t,r,i,n){var c=document.getElementById("porcentaje_"+a);c.innerHTML=t+" ","Porcentaje %"==n?c.innerHTML+="%":c.innerHTML+=n,document.getElementById("formula_metrica_"+a).innerHTML=r+" = "+t,crearGraficaNavegadores(["Cumple","No cumple"],[t,i[1]-t],"grafica_"+a),document.getElementById("custom-tabs-one-"+e+"-tab").innerHTML=e+" - Resultado",$("#formulario-"+a).css({display:"none"}),$("#resultado-"+a).css({display:""})}function mostrarResultadoCaracteristica(a,e,t,r){document.getElementById("porcentaje_caracteristica_"+a).innerHTML=e+" %";let i=document.getElementById("lista_metricas");i.innerHTML="",r.forEach(a=>{var e="";e=void 0!==a.abreviatura?a.abreviatura:a.nombre;let t=document.createElement("li");t.innerHTML="<strong>"+e+"</strong>",i.appendChild(t)}),document.getElementById("formula_caracteristica_"+a).innerHTML=t+" = "+e,crearGraficaNavegadores(["Cumple","No cumple"],[e,100-e],"grafica_caracteristica_"+a),$("#resultado_caracteristica_info").css({display:"none"}),$("#resultado_caracteristica").css({display:""})}function analizarPagina(){window.location.href="/analizarPagina"}$(document).ready(function(){mostrarCaracteristicas();var a=localStorage.getItem("evaluacionToken");null!=a?$.ajax({url:"/validarToken",data:{token:a},type:"POST",dataType:"json",success:function(a){a.valido?($("#nombre").val(a.plataforma_nombre),$("#url").val(a.plataforma_url)):(localStorage.removeItem("evaluacionToken"),localStorage.removeItem("transparencia"),ocultarCaracteristicas())},error:function(a,e,t){$(document).Toasts("create",{class:"bg-danger",title:"\xa1Error!",subtitle:"Operaci\xf3n fallida",body:"Fallo en la operacion.",icon:"fas fa-check-circle",autohide:!0,delay:3e3})}}):ocultarCaracteristicas(),$(".sidebar-container .nav-link").on("click",function(a){a.preventDefault(),$(".sidebar-container .nav-link").removeClass("active").css(inactivo),$(this).addClass("active").css(activo),$(this).closest(".nav-treeview").length&&$(this).closest(".nav-item.has-treeview").children(".nav-link").addClass("active").css(activo),$(this).closest(".nav-treeview").length&&$(this).css(activoSubmenu)})}),document.addEventListener("DOMContentLoaded",function(){var a=document.getElementById("sidebarToggle"),e=document.getElementById("closeSidebar"),t=document.getElementById("sidebar");a.addEventListener("click",function(){t.classList.add("show")}),e.addEventListener("click",function(){t.classList.remove("show")})}),$(".sidebar-container .has-treeview > .nav-link").on("click",function(){$(".sidebar-container .has-treeview").not($(this).parent()).removeClass("menu-open menu-is-opening"),$(".sidebar-container .has-treeview").not($(this).parent()).children(".nav-treeview").hide()});const chartInstances={};function crearGraficaNavegadores(a=[],e=[],t=""){let r=document.getElementById(t).getContext("2d");chartInstances[t]&&chartInstances[t].destroy(),chartInstances[t]=new Chart(r,{type:"doughnut",data:{labels:a,datasets:[{data:e,backgroundColor:["#00a65a","#f56954"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!1},tooltip:{callbacks:{label:function(a){let e=a.label||"";return e&&(e+=": "),e+=a.formattedValue}}}}}})}function agregarElemento(a){let e=prompt("Por favor, ingrese el nombre del elemento a agregar:");if(!e){alert("No se ingres\xf3 un nombre v\xe1lido. No se agregar\xe1 ning\xfan elemento.");return}let t=e.replace(/\s+/g,"_").toLowerCase(),r=document.getElementById("calcular_metrica_"+a),i=document.createElement("div");i.className="form-group";let n=document.createElement("label");n.htmlFor=t,n.textContent=e;let c=document.createElement("input");c.type="number",c.id=t,c.name=t,c.className="form-control",i.appendChild(n),i.appendChild(c),r.insertBefore(i,r.firstChild)}function calcularMetrica(a){for(var e=document.getElementById("calcular_metrica_"+a),t={},r=e.getElementsByTagName("input"),i=0;i<r.length;i++){var n=r[i];"number"===n.type?t[n.name]=parseFloat(n.value):n.checked&&(t[n.name]=n.value)}$.ajax({url:"/calcularMetrica",type:"POST",data:JSON.stringify({id_metrica:a,datos:t,token:localStorage.getItem("evaluacionToken")}),dataType:"json",success:function(a){document.getElementById("porcentaje_"+a.id_metrica).innerHTML=a.resultado+"%",mostrarResultadoMetrica(a.id_metrica,a.abreviatura,a.resultado,a.formula,a.escala,a.unidad),validarCaracteristica(a.id_caracteristica,"subcaracteristica"),$(document).Toasts("create",{class:"bg-success",title:"\xa1\xc9xito!",subtitle:"Operaci\xf3n completada",body:"Se realizo el calculo de la metrica correctamente.",icon:"fas fa-check-circle",autohide:!0,delay:3e3})},error:function(a,e,t){$(document).Toasts("create",{class:"bg-danger",title:"\xa1Error!",subtitle:"Operaci\xf3n fallida",body:"Fallo en la operacion.",icon:"fas fa-check-circle",autohide:!0,delay:3e3})}})}function validarCaracteristica(a,e){$.ajax({url:"/validarCalculoCaracteristica",type:"POST",data:{id_caracteristica:a,token:localStorage.getItem("evaluacionToken"),tipo:e},dataType:"json",success:function(a){a.resultado.calcular&&calcularValorCaracteristica(a.resultado.id_caracteristica,a.resultado.tipo)},error:function(a,e,t){$(document).Toasts("create",{class:"bg-danger",title:"\xa1Error!",subtitle:"Operaci\xf3n fallida",body:"Fallo en la operacion.",icon:"fas fa-check-circle",autohide:!0,delay:3e3})}})}function calcularValorCaracteristica(a,e){$.ajax({url:"/calcularValorCaracteristica",type:"POST",data:{id_caracteristica:a,token:localStorage.getItem("evaluacionToken"),tipo:e},dataType:"json",success:function(t){"subcaracteristica"==t.tipo&&mostrarResultadoCaracteristica(t.id_caracteristica,t.resultado,t.formula,t.metricas),""!=t.siguiente_calculo&&validarCaracteristica(a,t.siguiente_calculo),$(document).Toasts("create",{class:"bg-success",title:"\xa1\xc9xito!",subtitle:"Operaci\xf3n completada",body:"Se realizo el calculo de la "+e+" "+t.nombre_caracteristica,icon:"fas fa-check-circle",autohide:!0,delay:3e3}),"transparencia"==e&&verTransparencia()},error:function(a,e,t){$(document).Toasts("create",{class:"bg-danger",title:"\xa1Error!",subtitle:"Operaci\xf3n fallida",body:"Fallo en la operacion.",icon:"fas fa-check-circle",autohide:!0,delay:3e3})}})}function cargarFormularioMetrica(a,e){document.getElementById("custom-tabs-one-"+e+"-tab").innerHTML=e,$("#formulario-"+a).css({display:""}),$("#resultado-"+a).css({display:"none"})}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$(document).ready(function(){$("#agregarPaginaForm").on("submit",function(a){a.preventDefault(),$(this).serialize();var e=$("#nombre").val(),t=$("#url").val();(null==localStorage.getItem("evaluacionToken")||confirm("Tiene una evaluacion en curso. Desea iniciar una nueva evaluacion?"))&&$.ajax({url:"/agregarPagina",type:"POST",data:{nombre:e,url:t},dataType:"json",success:function(a){a.estado?($(document).Toasts("create",{class:"bg-success",title:"\xa1\xc9xito!",subtitle:"Operaci\xf3n completada",body:"Iniciando analisis.",icon:"fas fa-check-circle",autohide:!0,delay:3e3}),mostrarCaracteristicas(),localStorage.setItem("evaluacionToken",a.token),localStorage.removeItem("transparencia",a.token),ocultarTransparencia(),verCaracteristica("disponibilidad")):$(document).Toasts("create",{class:"bg-danger",title:"\xa1Error!",subtitle:"Operaci\xf3n fallida",body:"Fallo en la operacion.",icon:"fas fa-check-circle",autohide:!0,delay:3e3})},error:function(a,e,t){$(document).Toasts("create",{class:"bg-danger",title:"\xa1Error!",subtitle:"Operaci\xf3n fallida",body:"Fallo en la operacion.",icon:"fas fa-check-circle",autohide:!0,delay:3e3})}})})});